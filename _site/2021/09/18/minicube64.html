<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="msvalidate.01" content="45CBBE1BD8265A2217DFDA630EB8F84A" /><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="ðŸ‘¾ Moving Rainbow in 6502 Assembly" /><meta name="author" content="Milo Fultz" /><meta property="og:locale" content="en_US" /><meta name="description" content="I made a moving rainbow in 6502 assembly for the Minicube64." /><meta property="og:description" content="I made a moving rainbow in 6502 assembly for the Minicube64." /><link rel="canonical" href="http://milofultz.com/2021/09/18/minicube64" /><meta property="og:url" content="http://milofultz.com/2021/09/18/minicube64" /><meta property="og:site_name" content="Milo Fultz" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-18T00:00:00+07:00" /> <script type="application/ld+json"> {"description":"I made a moving rainbow in 6502 assembly for the Minicube64.","author":{"@type":"Person","name":"Milo Fultz"},"@type":"BlogPosting","url":"http://milofultz.com/2021/09/18/minicube64","headline":"ðŸ‘¾ Moving Rainbow in 6502 Assembly","dateModified":"2021-09-18T00:00:00+07:00","datePublished":"2021-09-18T00:00:00+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://milofultz.com/2021/09/18/minicube64"},"@context":"https://schema.org"}</script><title> ðŸ‘¾ Moving Rainbow in 6502 Assembly - Milo Fultz</title><link rel="shortcut icon" href="data:,"><link rel="alternate" type="application/atom+xml" title="Milo Fultz" href="/atom.xml"><link rel="alternate" type="application/json" title="Milo Fultz" href="http://milofultz.com/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;color:inherit;margin:0;padding:0}body{font-family:sans-serif, system-ui;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;text-align:justify;text-justify:initial;font-weight:500;line-height:1.75;font-size:1rem;background-color:#CFCFCF;color:#101010;overflow-wrap:break-word;word-wrap:break-word}nav ul{border-right:1px solid #101010;display:flex;flex-flow:row-reverse wrap}a{text-decoration-skip-ink:auto;text-decoration:underline}a:hover{color:#16F}.prewrap{white-space:pre-wrap}pre{margin:.5rem 0;padding:.5rem;tab-size:2}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1.5rem 0 1rem -.5rem}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#444;color:#EEE}code{padding:.1rem .2rem}pre code{border:none;padding-left:0}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#333;height:1px;border:0;margin:1.5em 1.5em}header{flex-basis:10rem;flex-grow:1;position:relative;overflow-wrap:break-word;word-wrap:break-word}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}footer{left:0px;bottom:0px;height:3em;width:100%;padding:1em}li{margin-left:20px}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.stars{line-height:.8em;letter-spacing:.5em;font-family:monospace;font-size:.6em}.footer-image{width:3em;float:right}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem;margin-left:0}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){body{text-align:left}header{flex-basis:100%;flex-grow:1}header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #333;padding-bottom:2rem}nav ul{border-right:0px;flex-flow:row wrap}.photos ul{margin-top:0.5rem}.post-datetime{display:none}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}table,th,td{text-align:left;padding:5px}td{border-top:1px solid gray}figcaption{font-size:smaller}</style></head><body><main role="main"><header role="banner"><nav role="navigation"><ul>
<li><a href="/">Now</a></li>
<li><a href="/about">About</a></li>
<li><a href="/projects/">Projects</a></li>
<li><a href="/thoughts/">Thoughts</a></li>
<li><a href="/reference/">Reference</a></li>
<li><a href="/search">Search</a></li>
<li><a href="https://github.com/milofultz/" target="_blank" rel="noopener noreferrer me">Github</a></li>
<li><a href="https://www.tinybrain.fans" target="_blank" rel="noopener noreferrer me">tinybrain.fans</a></li>
<li><a href="/atom.xml">RSS</a></li>
</ul></nav></header><section class="post"><h2>ðŸ‘¾ Moving Rainbow in 6502 Assembly</h2>
<p>Iâ€™ve been wanting to get into assembly language forever but havenâ€™t found a way to iterate and test in a satisfying way to makes learning for me really easy. Recently, I saw <a href="https://merveilles.town/web/accounts/124" target="_blank" rel="noopener noreferrer me">flame from aeriform.io</a> had developed the <a href="https://github.com/aeriform-io/minicube64/" target="_blank" rel="noopener noreferrer me">Minicube64</a>, which is a fantasy console based on the 6502.</p>
<p>The 6502 is the same chip that was found in early Commodores, the BBC Micro, the NES/Famicom, the Apple ][, and zillions of others. Itâ€™s a simplified amount of assembly instructions, which lends itself to picking it up much more easily and quickly than would be possible with a more expansive set like on modern processors. Perfect.</p>
<p>After installing <a href="https://github.com/aeriform-io/minicube64/" target="_blank" rel="noopener noreferrer me">Minicube64</a>, I did <a href="http://skilldrick.github.io/easy6502/" target="_blank" rel="noopener noreferrer me">a tutorial</a>, read a ton of <a href="http://www.6502.org/tutorials/6502opcodes.html" target="_blank" rel="noopener noreferrer me">reference materials</a>, and <a href="https://www.tinybrain.fans/minicube64.html" target="_blank" rel="noopener noreferrer me">took some notes</a> while going through some of the demo files.</p>
<p>Not too far after this, I saw that a gamejam for the <a href="https://github.com/aeriform-io/minicube64/" target="_blank" rel="noopener noreferrer me">Minicube64</a> was being held at <a href="https://itch.io/jam/minicubejam" target="_blank" rel="noopener noreferrer me">itch.io</a> and I set out to have a rainbow render on the screen, and if possible, animate it left to right. This felt like a manageable goal and through a LOT of trial and error, was finally able to get there.</p>
<p>This is the code ðŸ‘‡</p>
<pre><code class="language-assembly">include "64cube.inc" 				; Include the helper functions

ENUM $0											; Enumerate values starting at $0000
	initColor rBYTE 1					; set initColor as 1 byte
ENDE												; End enumeration

	org $200									; Set program origin to $0200
	sei												; Set interrupt disable flag

	; Set the stack pointer to be #$ff (low bits of $0100-01ff)
	ldx #$ff									; Load value $ff into X
	txs												; Transfer value of X into the stack
														;   pointer

	; Set the video buffer page in the $f000 page in memory
	lda #$f										; Load high byte of page into A
														;   register
	sta VIDEO									; Store value in A at 'VIDEO'

	; Set the colors buffer page in the $5000 page in memory
	lda #$5										; Load highbyte of page into 'a'
														;   register
	sta COLORS								; Store value in A at 'COLORS'

	_setw IRQ, VBLANK_IRQ			; Set value of VBLANK_IRQ to address of
														;   'IRQ' label

	cli												; Clear interrupt disable flag

Infinite:										; Set 'Infinite' label
	dec initColor							; Decrement initColor
	lda initColor							; Load initColor into A
	and #$3f									; Ensure A never goes above #$3f
	jsr Draw									; Jump to 'Draw' subroutine
	jmp Infinite							; Create infinite loop

IRQ:												; Set 'IRQ' label
	rti												; Return from interrupt

Draw:												; Set 'Draw' label

; This will draw a column of each color from one end of the color spectrum to
;   the other. Eventually, I hope to have this scale from left to right with
;   animation.
;
; A = Address of color within the COLORS page
; X = Col counter (ff-00: ff being the last col of the last row within the
;       four subrows, 00 being the first col of the first row in the subrows
; Y = Row counter (ff-f0: ff being the last four subrows, ff being the first)

	ldx #$0										; Initialize column counter (X)
	ldy #$f										; Initialize row counter (Y)

	Loop:
		lda initColor						; Set accumulator to color value
		SubLoop:								; Create a subloop label
			and #$3f							; Ensure A never goes above #$3f
			sta $f000,X						; Store A in video page plus X for
			sta $f100,X						;   all columns
			sta $f200,X
			sta $f300,X
			sta $f400,X
			sta $f500,X
			sta $f600,X
			sta $f700,X
			sta $f800,X
			sta $f900,X
			sta $fa00,X
			sta $fb00,X
			sta $fc00,X
			sta $fd00,X
			sta $fe00,X
			sta $ff00,X
			sec										; Set carry flag to wrangle SBC
			sbc #1								; Decrement the color value
			dex										; Decrement column counter (X)
			bne SubLoop						; If color value is not zero, go to subloop
		dex											; Decrement col counter (X)
		dey											; Decrement row counter (Y)
		bne Loop								; If Y is not zero, go to Loop
	rts												; Else return from the subroutine

Palette:										; Set 'Palette' label

; This will set the palette of colors available in the COLORS page, enumerating
;   from $00 upward within that page.

	org $0500									; Set program origin to $0500

	hex FF0000								; Set these colors in colors page
	hex FF1500
	hex FF2F00
	hex FF4400
	hex FF5E00
	hex FF7700
	hex FF8C00
	hex FFA600
	hex FFBF00
	hex FFD500
	hex FFEE00
	hex FBFF00
	hex E1FF00
	hex C8FF00
	hex B3FF00
	hex 99FF00
	hex 80FF00
	hex 6AFF00
	hex 51FF00
	hex 3CFF00
	hex 22FF00
	hex 09FF00
	hex 00FF0D
	hex 00FF26
	hex 00FF40
	hex 00FF55
	hex 00FF6E
	hex 00FF84
	hex 00FF9D
	hex 00FFB7
	hex 00FFCC
	hex 00FFE5
	hex 00FFFF
	hex 00EAFF
	hex 00D0FF
	hex 00BBFF
	hex 00A2FF
	hex 0088FF
	hex 0073FF
	hex 0059FF
	hex 0040FF
	hex 002AFF
	hex 0011FF
	hex 0400FF
	hex 1E00FF
	hex 3700FF
	hex 4C00FF
	hex 6600FF
	hex 8000FF
	hex 9500FF
	hex AE00FF
	hex C300FF
	hex DD00FF
	hex F700FF
	hex FF00F2
	hex FF00D9
	hex FF00BF
	hex FF00AA
	hex FF0090
	hex FF007B
	hex FF0062
	hex FF0048
	hex FF0033
	hex FF0019
</code></pre>
<p>Iâ€™ve added quite a bit of annotation to this, but will probably dig into it more in depth at a later date. To get it running:</p>
<ul>
<li><a href="https://github.com/aeriform-io/minicube64/releases" target="_blank" rel="noopener noreferrer me">install Minicube64</a></li>
<li>create a new file called <code class="highlighter-rouge">rainbow.s</code> and put the above contents within it</li>
<li>run this in your shell: <code class="highlighter-rouge">./minicube ./path/to/rainbow.s</code>
</li>
</ul>
<span class="meta"><time datetime="2021-09-18T00:00:00+07:00">September 18, 2021</time></span></section><footer> <a href="https://lieu.cblgh.org/random" target="_blank" rel="noopener noreferrer me"><img src="https://webring.xxiivv.com/icon.black.svg" class="footer-image"></a>Â <a href="https://merveilles.town/@milofultz" target="_blank" rel="noopener noreferrer me"><img src="https://raw.githubusercontent.com/XXIIVV/oscean/master/media/icon/merveilles.svg" class="footer-image"></a></footer></main></body></html>
